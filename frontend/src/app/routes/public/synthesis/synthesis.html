<div class="row f-s-12 justify-content-between wrapper-page-content">
  <div class="col-sm-12">
    <mat-card class="r-0">
      <mat-card-content class="app-title-bar">
        <h2 class="th2">Rapports</h2>
      </mat-card-content>
      <mat-card-content>
        <div class="app-form-wrapper">
          <form (submit)="onSubmit()" [formGroup]="form!" appearance="outline">
            <div class="app-input-label col-sm-12">
              Unité de synthèse
              <span style="color: red">*</span>
            </div>
            <div style="margin-bottom: 15px" class="col-sm-12">
              <select
                id="rnrType"
                class="span3 ng-pristine ng-valid app-select f-s-12 justify-content-between"
                formControlName="synthesis_unit"
              >
                <option option value="">Sélectionnez une unité de synthèse</option>
                @for (item of syntheses; track $index) {
                <option value="{{item.id}}">{{$index+1}} - {{item.item}}</option>
                }
              </select>
            </div>
            <div class="app-input-label col-sm-12">
              Equipement & structure
              <span style="color: red">*</span>
            </div>
            <div style="margin-bottom: 15px" class="col-sm-12">
              <select
                id="rnrType"
                class="span3 m-r-8 r-1 ng-pristine ng-valid app-select f-s-12 justify-content-between"
                formControlName="equipment"
              >
                <option option value="">Sélectionnez un équipement</option>
                @for (item of equipmentList; track $index) {
                <option value="{{item.id}}">{{item.name}}</option>
                }
              </select>
              <select
                id="rnrType"
                class="span3 m-r-8 r-1 ng-pristine ng-valid app-select f-s-12 justify-content-between"
                formControlName="structure"
              >
                <option option value="">Séléctionnez une structure</option>
                <option value="all">{{'All'}}</option>
                @for (item of structureList; track $index) {
                <option value="{{item.id}}">{{item.name}}</option>
                }
              </select>
            </div>
            <div class="col-sm-12">
              <div class="app-input-label col-sm-12">
                Intervalle de date
                <span style="color: red">*</span>
              </div>
              <div>
                <select
                  id="rnrType"
                  class="span3 m-r-8 r-1 ng-pristine ng-valid app-select f-s-12 justify-content-between"
                  formControlName="start_period"
                >
                  <option option value="">Période de début</option>
                  @for (item of periods; track $index) {
                  <option value="{{item.periodName}}">{{item.periodName}}</option>
                  }
                </select>
                <select
                  id="rnrType"
                  class="span3 m-r-8 r-1 ng-pristine ng-valid app-select f-s-12 justify-content-between"
                  formControlName="end_period"
                >
                  <option option value="">Période de fin</option>
                  @for (item of periods; track $index) {
                  <option value="{{item.periodName}}">{{item.periodName}}</option>
                  }
                </select>
              </div>
              @if(start_Date !== '' && end_Date !== ''){
              <div
                style="margin-top: 10px"
                class="f-s-12 d-flex justify-content-between align-items-center"
              >
                * Période du {{start_Date}} au {{end_Date}}
              </div>
              }
            </div>
            <div class="col-sm-12" style="margin-top: 20px">
              <button
                [style.cursor]="!enabledSubmit || lockedButton ? 'not-allowed' : 'pointer'"
                [disabled]="!enabledSubmit || lockedButton"
                type="submit"
                (click)="onSubmit()"
                class="search action-button"
              >
                Générer
              </button>
            </div>
          </form>
        </div>
      </mat-card-content>
      <mat-card-content style="margin-bottom: 15px; margin-top: 30px">
        <p class="th2"></p>
      </mat-card-content>
      <mat-card-content style="margin-bottom: 20px; margin-top: 10px; min-height: 200px">
        <div>
          @if(synthesis_data){ @if(synthesis_unit === SYNTHESE_HBDOMMADAIRE){
          <div>
            <div #tableContainer style="overflow-x: auto; width: 100%">
              <table #tableExport class="excel-table">
                <thead>
                  <tr>
                    <th colspan="9" class="title">{{SHEET_TITLE}}</th>
                  </tr>
                  <tr>
                    <th colspan="2" class="left">Structure : CeDReS</th>
                    <th colspan="4">Période du :</th>
                    <th colspan="3" class="right">{{start_Date}} au {{end_Date}}</th>
                  </tr>
                  <tr class="section">
                    <th colspan="2" class="red">Réactifs Principaux</th>
                    <th class="center">Qté utilisée</th>
                    <th class="center">CMM</th>
                    <th class="center">SDU</th>
                    <th class="center">QAC</th>
                    <th class="center">Total Tests réalisables</th>
                    <th class="center" colspan="2">MSD</th>
                  </tr>
                </thead>
                <tbody>
                  @for (item of synthesis_data.compiled_specific_primary; track $index) {
                  <tr>
                    <td>{{item.intrant.code}}</td>
                    <td>{{item.intrant.name}}</td>
                    <td class="center">{{item.distributionStock}}</td>
                    <td class="center">{{item.cmm}}</td>
                    <td class="center">{{item.availableStock}}</td>
                    <td class="center">{{item.qac}}</td>
                    <td class="center highlight">{{item.test_realisable || 0}}</td>
                    <td colspan="2" class="center">{{item.msd || 0}}</td>
                  </tr>
                  }

                  <tr>
                    <td style="height: 20px; border-left: 0; border-right: 0;" colspan="9"></td>
                  </tr>

                  <tr class="section">
                    <th colspan="2" class="red">Consommables de charge virale accompagnant</th>
                    <th class="center">UNITE</th>
                    <th class="center">KIT</th>
                    <th class="center">Unité primaire</th>
                    <th class="center">Qté utilisée</th>
                    <th class="center">SDU</th>
                    <th class="center">QAC</th>
                    <th class="center">% de</th>
                  </tr>

                  @for (item of synthesis_data.compiled_specific_secondary; track $index) {
                  <tr>
                    <td>{{item.intrant.code}}</td>
                    <td>{{item.intrant.name}}</td>
                    <td class="center">{{ item.intrant.sku || 'sku' }}</td>
                    <td class="center kit">{{ item.kit || 0 }}</td>
                    <td class="center yellow">{{ item.primary_unit || 0 }}</td>
                    <td class="center">{{ item.distributionStock }}</td>
                    <td class="center">{{ item.availableStock }}</td>
                    <td class="center qac">{{ item.qac || 0 }}</td>
                    <td class="center">{{ item.taux || 0 }}</td>
                  </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
          } @else {
          <div #tableContainer style="overflow-x: auto; width: 100%">
            <table #tableExport>
              <thead>
                <tr>
                  @for(item of information_unit.subUnits; track $index){
                  <th style="text-align: center" [colSpan]="item.subSubUnits.length">
                    {{item.name}}
                  </th>
                  }
                </tr>
                <tr>
                  @for(subUnits of information_unit.subUnits; track $index){
                  @if(subUnits.subSubUnits.length){ @for(sub of subUnits.subSubUnits; track $index){
                  <th style="text-align: center">{{sub.name}}</th>
                  } } }
                </tr>
              </thead>
              <tbody>
                <tr>
                  @for(subUnits of information_unit.subUnits; track $index){
                  @if(subUnits.subSubUnits.length){ @for(sub of subUnits.subSubUnits; track $index){
                  <td style="text-align: center">{{synthesis_data['unit_'+sub.id]}}</td>
                  } } @if(!subUnits.subSubUnits.length){
                  <td style="text-align: center">{{synthesis_data['unit_'+subUnits.id]}}</td>
                  } }
                </tr>
              </tbody>
            </table>
          </div>
          } }
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>

@if(synthesis_data){
<div
  style="
    position: fixed;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 40px;
    z-index: 1000;
    display: flex;
    align-items: center;
    flex-direction: row;
    gap: 0.5rem;
    padding: 13px;
    background: rgba(0, 0, 0, 0.7);
  "
>
  <div class="row">
    <button class="action-button" (click)="exportPDFMulti()">Exporter vers pdf</button>
    <button class="action-button" (click)="exportExcelPro()">Exporter vers excel</button>
  </div>
</div>
}
